## Quick context for AI coding agents

- This is a Vite + React + TypeScript single-page application scaffolded with shadcn-ui and Tailwind. The app is a POS/ERP-style frontend that talks directly to a Supabase backend (Postgres). Key directories:
  - `src/pages/` — feature pages (Products, Sales, Purchases, Settings, etc.). Use these to find UI + data access patterns.
  - `src/components/` — shared UI primitives (toaster, layout, pdf, pos, ui). Look here for presentational components.
  - `src/integrations/supabase/` — Supabase client and generated types. All DB calls use the exported `supabase` client.
  - `src/hooks/` — app-specific hooks (permissions, mobile, toast) used across pages.

## Architecture & data flow (big picture)

- Routing and auth: `src/App.tsx` mounts `BrowserRouter` and wraps protected pages with a `ProtectedRoute` component that listens to `supabase.auth.onAuthStateChange` and redirects unauthenticated users to `/auth`.
- Data fetching: pages use `@tanstack/react-query` (`useQuery`, `useMutation`) and call `supabase.from(...).select/insert/update` or RPCs (e.g., `generate_service_number`) directly.
- State & side effects: keep mutations in `useMutation` and call `queryClient.invalidateQueries()` after changes — this pattern is repeated in pages such as `src/pages/Suppliers.tsx` and `src/pages/TechnicalServices.tsx`.

## Developer workflows & useful commands

- Install: `npm i` (project expects Node/npm — README suggests nvm for Node management).
- Dev server: `npm run dev` — Vite serves at host `::` and port `8080` (see `vite.config.ts`).
- Build: `npm run build` (or `npm run build:dev` for development mode build).
- Lint: `npm run lint` (ESLint configured).
- Preview production build: `npm run preview`.

When editing: imports use an alias `@` → `src` (see `tsconfig.json` and `vite.config.ts`). Use that alias when adding new modules.

## Conventions and patterns to follow

- Files in `src/pages/*` are feature-focused. Keep page-level data fetching in the page and keep UI extraction in `src/components`.
- Use `react-query` for all server interaction to maintain caching and background updates.
- Follow existing error handling pattern: pages often return/throw on auth absence (e.g., `if (!user) throw new Error('Usuario no autenticado')`). Mirror these messages and language when adding new checks.
- RPC and sequence numbers: Several flows call Postgres RPCs (e.g., `generate_service_number`, `generate_delivery_number`) before inserts. Preserve the RPC call then use the returned number in the insert payload.

## Integration notes & secrets

- Supabase client is at `src/integrations/supabase/client.ts`. The file is generated and contains the public URL and a publishable key used by the frontend. Treat the publishable key as public — server-only secrets live in `supabase/` server-side functions/migrations.
- Many pages call `supabase.auth.getUser()` or `supabase.auth.getSession()` to obtain the current user; when creating records, set `user_id` from that returned user.

## Files to inspect for examples

- `src/App.tsx` — routing, ProtectedRoute and global providers (react-query, tooltip, toaster)
- `src/integrations/supabase/client.ts` — Supabase client usage
- `src/pages/TechnicalServices.tsx`, `src/pages/Sales.tsx`, `src/pages/Purchases.tsx` — examples of mutations, RPC usage, and transactional sequences
- `vite.config.ts`, `tsconfig.json` — alias and dev server config

## Small heuristics for editing

- When adding a new page, add its route in `src/App.tsx` above the catch-all `"*"` route and wrap it with `<ProtectedRoute>` if it must be authenticated.
- Use `useQuery` keys that are simple and consistent (most files use string keys like `{ queryKey: ['suppliers'] }`).
- For DB changes: prefer using `useMutation` with optimistic updates where appropriate and follow existing pattern of `queryClient.invalidateQueries(['...'])` after success.

## Safety / Do not change

- Do not edit generated files inside `src/integrations/supabase/` (header: "This file is automatically generated").
- Avoid committing service secrets to source. The repo currently contains a publishable Supabase key — do not convert this into a server secret.

If anything is unclear or you'd like additional rules (naming, testing, commit message conventions), tell me what to add and I will update this file.
